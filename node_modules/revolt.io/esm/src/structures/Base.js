import { BitField } from '../util/mod.js';
export class Base {
    constructor(client) {
        Object.defineProperty(this, "client", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: client
        });
        Object.defineProperty(this, "id", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
    }
    equals(that) {
        if (!that)
            return false;
        for (const key in that) {
            const a = that[key], b = this[key];
            if (a instanceof Base && !a.equals(b))
                return false;
            if (a instanceof BitField &&
                a.bitfield !== b.bitfield) {
                return false;
            }
            // TODO: Add collection checking.
            if (typeof a === 'object' && a != null)
                continue;
            if (a !== b)
                return false;
        }
        return true;
    }
    _update(data, clear) {
        const clone = this._clone();
        this._patch(data, clear);
        return clone;
    }
    _patch(data, _clear) {
        if ('id' in data)
            this.id = data.id;
        if ('_id' in data) {
            if (typeof data._id === 'string')
                this.id = data._id;
            if (typeof data._id === 'object')
                this.id = data._id.user;
        }
        return this;
    }
    _clone() {
        const clone = Object.assign(Object.create(this), this);
        for (const key in clone) {
            const prop = clone[key];
            if (prop instanceof Base)
                clone[key] = prop._clone();
        }
        return clone;
    }
}
