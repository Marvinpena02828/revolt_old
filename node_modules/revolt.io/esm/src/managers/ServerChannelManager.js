import { BaseManager } from './BaseManager.js';
import { TypeError } from '../errors/mod.js';
import { ServerChannel, TextChannel, VoiceChannel, } from '../structures/mod.js';
import { UUID } from '../util/mod.js';
export class ServerChannelManager extends BaseManager {
    constructor(server) {
        super(server.client);
        Object.defineProperty(this, "server", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: server
        });
        Object.defineProperty(this, "holds", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: ServerChannel
        });
    }
    _add(data) {
        let channel;
        switch (data.channel_type) {
            case 'TextChannel':
                channel = new TextChannel(this.client, data);
                break;
            case 'VoiceChannel':
                channel = new VoiceChannel(this.client, data);
                break;
            default:
                throw new Error(`Unknown channel type: ${data.channel_type}`);
        }
        this.cache.set(channel.id, channel);
        return channel;
    }
    async create({ name, type = 'Text', description }) {
        const data = await this.client.api.post(`/servers/${this.server.id}/channels`, {
            body: {
                name,
                type,
                description,
                nonce: UUID.generate(),
            },
        });
        return this._add(data);
    }
    async fetch(channel, { force = true } = {}) {
        const id = this.resolveId(channel);
        if (!id) {
            throw new TypeError('INVALID_TYPE', 'channel', 'ServerChannelResolvable');
        }
        if (!force) {
            const channel = this.cache.get(id);
            if (channel)
                return channel;
        }
        const data = await this.client.api.get(`/servers/${this.server.id}/channels/${id}`);
        return this._add(data);
    }
}
