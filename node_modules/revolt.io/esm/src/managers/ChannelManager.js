import { BaseManager } from './BaseManager.js';
import { TypeError } from '../errors/mod.js';
import { Channel, DMChannel, GroupChannel, NotesChannel, TextChannel, VoiceChannel, } from '../structures/mod.js';
export class ChannelManager extends BaseManager {
    constructor() {
        super(...arguments);
        Object.defineProperty(this, "holds", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: null
        });
    }
    _add(data) {
        let channel;
        switch (data.channel_type) {
            case 'TextChannel':
                channel = new TextChannel(this.client, data);
                break;
            case 'VoiceChannel':
                channel = new VoiceChannel(this.client, data);
                break;
            case 'DirectMessage':
                channel = new DMChannel(this.client, data);
                break;
            case 'Group':
                channel = new GroupChannel(this.client, data);
                break;
            case 'SavedMessages':
                channel = new NotesChannel(this.client, data);
                if (this.client.user)
                    this.client.user.notes = channel;
                break;
            default:
                throw new Error(`Unknown Channel Type: ${data}`);
        }
        this.cache.set(channel.id, channel);
        return channel;
    }
    _remove(id) {
        const channel = this.cache.get(id);
        if (channel?.inServer()) {
            channel.server?.channels.cache.delete(id);
        }
        super._remove(id);
    }
    async delete(channel) {
        const id = this.resolveId(channel);
        if (!id) {
            throw new TypeError('INVALID_TYPE', 'channel', 'ChannelResolvable');
        }
        await this.client.api.delete(`/channels/${id}`);
    }
    async fetch(channel, { force = true } = {}) {
        const id = this.resolveId(channel);
        if (!id) {
            throw new TypeError('INVALID_TYPE', 'channel', 'ChannelResolvable');
        }
        if (!force) {
            const channel = this.cache.get(id);
            if (channel)
                return channel;
        }
        const data = await this.client.api.get(`/channels/${id}`);
        return this._add(data);
    }
    resolve(channel) {
        if (channel instanceof Channel)
            return channel;
        return super.resolve(channel);
    }
    resolveId(channel) {
        if (channel instanceof Channel)
            return channel.id;
        return super.resolveId(channel);
    }
}
